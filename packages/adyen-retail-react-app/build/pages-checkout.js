"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[541],{72485:(e,t,r)=>{r.r(t),r.d(t,{default:()=>fe});var a=r(15861),n=r(67294),l=r(86896),c=r(44012),d=r(57747),o=r(22338),i=r(79078),s=r(68519),u=r(28929),m=r(74153),p=r(7405),y=r(25567),g=r(352),f=r(11701),E=r(52536),b=r(63671),h=r(45928),v=r(87462),_=r(45987),x=r(64572),C=r(45697),k=r.n(C),M=r(22757),O=r(49289),P=r(85894),S=r(71293),I=r(87536),w=r(80598),T=r(39391),Z=r(97636),j=r(38078),A=r(47056),D=r(33470),K=r(42669),B=r(97173),N=r(93717),L=r(21238),z=r(19385),V=r(15703),$=r.n(V),q=r(5418),R=r(32735),W=r(5674);const Y=(0,D.defineMessages)({required:{defaultMessage:[{type:0,value:"Required"}],id:"use_credit_card_fields.error.required"},cardNumberInvalid:{defaultMessage:[{type:0,value:"Please enter a valid card number."}],id:"use_credit_card_fields.error.valid_card_number"},nameInvalid:{defaultMessage:[{type:0,value:"Please enter a valid name."}],id:"use_credit_card_fields.error.valid_name"},dateInvalid:{defaultMessage:[{type:0,value:"Please enter a valid date."}],id:"use_credit_card_fields.error.valid_date"},codeInvalid:{defaultMessage:[{type:0,value:"Please enter a valid security code."}],id:"use_credit_card_fields.error.valid_security_code"},cardNumber:{defaultMessage:[{type:0,value:"Card Number"}],id:"use_credit_card_fields.label.card_number"},cardType:{defaultMessage:[{type:0,value:"Card Type"}],id:"use_credit_card_fields.label.card_type"},cardName:{defaultMessage:[{type:0,value:"Name on Card"}],id:"use_credit_card_fields.label.name"},expiryDate:{defaultMessage:[{type:0,value:"Expiration Date"}],id:"use_credit_card_fields.label.expiry"},securityCode:{defaultMessage:[{type:0,value:"Security Code"}],id:"use_credit_card_fields.label.security_code"}});var X=r(89292);function U(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function F(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?U(Object(r),!0).forEach((function(t){(0,x.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):U(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const H=({form:e,prefix:t=""})=>{var r;const{formatMessage:a}=(0,l.Z)(),c=function({form:{control:e,formState:{errors:t}},prefix:r=""}){const{formatMessage:a}=(0,l.Z)();return{number:{name:`${r}number`,label:a(Y.cardNumber),defaultValue:"",type:"text",rules:{required:a({defaultMessage:[{type:0,value:"Please enter your card number."}],id:"use_credit_card_fields.error.required_card_number"}),validate:e=>$().number(e).isValid||a(Y.cardNumberInvalid)},error:t[`${r}number`],inputProps:{inputMode:"numeric"},control:e},cardType:{name:`${r}cardType`,label:a(Y.cardType),defaultValue:"",type:"hidden",error:t[`${r}cardType`],control:e},holder:{name:`${r}holder`,label:a(Y.cardName),defaultValue:"",type:"text",rules:{required:a({defaultMessage:[{type:0,value:"Please enter your name as shown on your card."}],id:"use_credit_card_fields.error.required_name"}),validate:e=>$().cardholderName(e).isValid||a(Y.nameInvalid)},error:t[`${r}holder`],control:e},expiry:{name:`${r}expiry`,label:a(Y.expiryDate),defaultValue:"",type:"text",placeholder:"MM/YY",rules:{required:a({defaultMessage:[{type:0,value:"Please enter your expiration date."}],id:"use_credit_card_fields.error.required_expiry"}),validate:e=>$().expirationDate(e).isValid||a(Y.dateInvalid)},error:t[`${r}expiry`],inputProps:{inputMode:"numeric"},control:e},securityCode:{name:`${r}securityCode`,label:a(Y.securityCode),defaultValue:"",type:"password",rules:{required:a({defaultMessage:[{type:0,value:"Please enter your security code."}],id:"use_credit_card_fields.error.required_security_code"}),validate:e=>$().cvv(e).isValid||a(Y.codeInvalid)},error:t[`${r}securityCode`],inputProps:({onChange:e})=>({inputMode:"numeric",maxLength:4,onChange(t){e(t.target.value.replace(/[^0-9 ]+/,""))}}),control:e}}}({form:e,prefix:t}),o=e.watch("cardType"),i=(0,j.getCreditCardIcon)(e.getValues().cardType),s=a("american-express"===o?{id:"credit_card_fields.tool_tip.security_code.american_express",defaultMessage:[{type:0,value:"This 4-digit code can be found on the front of your card."}]}:{id:"credit_card_fields.tool_tip.security_code",defaultMessage:[{type:0,value:"This 3-digit code can be found on the back of your card."}]});return n.createElement(d.xu,null,n.createElement(u.K,{spacing:5},n.createElement(X.Z,(0,v.Z)({},c.number,{formLabel:n.createElement(N.k,{justify:"space-between"},n.createElement(q.l,null,c.number.label),n.createElement(u.K,{direction:"row",spacing:1},n.createElement(z.QH,{layerStyle:"ccIcon"}),n.createElement(z.XT,{layerStyle:"ccIcon"}),n.createElement(z.LT,{layerStyle:"ccIcon"}),n.createElement(z.Vq,{layerStyle:"ccIcon"}))),inputProps:({onChange:t})=>F(F({},c.number.inputProps),{},{onChange(r){const a=r.target.value.replace(/[^0-9 ]+/,""),{card:n}=$().number(a),l=n?(0,j.formatCreditCardNumber)(a,n):a;return e.setValue("cardType",(null==n?void 0:n.type)||""),t(l)}})}),i&&(null===(r=e.getValues().number)||void 0===r?void 0:r.length)>2&&n.createElement(R.x,{width:"60px"},n.createElement(i,{layerStyle:"ccIcon"}))),n.createElement(X.Z,c.holder),n.createElement(W.M,{columns:[2,2,3],spacing:5},n.createElement(X.Z,(0,v.Z)({},c.expiry,{inputProps:({onChange:e})=>F(F({},c.expiry.inputProps),{},{onChange(t){let r=t.target.value.replace("/","");if(!(r.match(/[^\d|/]/g)||r.length>4))return r.length>=2&&(r=`${r.substr(0,2)}/${r.substr(2)}`),e(r)},onKeyDown(t){if(8===t.keyCode||46===t.keyCode)return t.preventDefault(),e(t.target.value.slice(0,-1))}})})),n.createElement(X.Z,(0,v.Z)({},c.securityCode,{formLabel:n.createElement(q.l,null,c.securityCode.label," ",n.createElement(L.u,{hasArrow:!0,placement:"top",label:s},n.createElement(z.sz,{boxSize:5,color:"gray.700",ml:1})))})))),n.createElement(X.Z,c.cardType))};H.propTypes={form:k().object.isRequired,prefix:k().string};const G=H;var Q=r(78462);const J=({form:e,onSubmit:t})=>{const{formatMessage:r}=(0,l.Z)(),{data:a}=(0,Z.useCurrentBasket)(),{currency:o}=(0,Q.U8)();return n.createElement("form",{onSubmit:e.handleSubmit(t)},n.createElement(u.K,{spacing:8},n.createElement(u.K,{spacing:5},n.createElement(d.xu,{border:"1px solid",borderColor:"gray.100",rounded:"base",overflow:"hidden"},n.createElement(K.E,{value:"cc"},n.createElement(d.xu,{py:3,px:[4,4,6],bg:"gray.50",borderBottom:"1px solid",borderColor:"gray.100"},n.createElement(B.Y,{value:"cc"},n.createElement(N.k,{justify:"space-between"},n.createElement(u.K,{direction:"row",align:"center"},n.createElement(S.x,{fontWeight:"bold"},n.createElement(c.Z,{defaultMessage:[{type:0,value:"Credit Card"}],id:"payment_selection.heading.credit_card"})),n.createElement(L.u,{hasArrow:!0,placement:"top",label:r({defaultMessage:[{type:0,value:"This is a secure SSL encrypted payment."}],id:"payment_selection.tooltip.secure_payment"})},n.createElement(z.mB,{color:"gray.700",boxSize:5}))),n.createElement(S.x,{fontWeight:"bold"},n.createElement(D.FormattedNumber,{value:null==a?void 0:a.orderTotal,style:"currency",currency:o}))))),n.createElement(d.xu,{p:[4,4,6],borderBottom:"1px solid",borderColor:"gray.100"},n.createElement(u.K,{spacing:6},n.createElement(u.K,{spacing:6},n.createElement(G,{form:e})))),n.createElement(d.xu,{py:3,px:[4,4,6],bg:"gray.50",borderColor:"gray.100"},n.createElement(B.Y,{value:"paypal"},n.createElement(d.xu,{py:"2px"},n.createElement(z.fR,{width:"auto",height:"20px"})))))))))};J.propTypes={form:k().object,onSubmit:k().func};const ee=J;var te=r(21103),re=r(45336),ae=r(62455),ne=r(67182);const le=["removePromoCode"],ce=["addressId","creationDate","lastModified","preferred"];function de(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function oe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?de(Object(r),!0).forEach((function(t){(0,x.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):de(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const ie=({payment:e})=>{var t;const r=(0,j.getCreditCardIcon)(null==e||null===(t=e.paymentCard)||void 0===t?void 0:t.cardType);return n.createElement(u.K,{direction:"row",alignItems:"center",spacing:3},r&&n.createElement(r,{layerStyle:"ccIcon"}),n.createElement(u.K,{direction:"row"},n.createElement(S.x,null,e.paymentCard.cardType),n.createElement(S.x,null,"•••• ",e.paymentCard.numberLastDigits),n.createElement(S.x,null,e.paymentCard.expirationMonth,"/",e.paymentCard.expirationYear)))};ie.propTypes={payment:k().object};const se=()=>{var e;const{formatMessage:t}=(0,l.Z)(),{data:r}=(0,Z.useCurrentBasket)(),i=(null==r?void 0:r.shipments)&&(null==r||null===(e=r.shipments[0])||void 0===e?void 0:e.shippingAddress),s=null==r?void 0:r.billingAddress,m=(null==r?void 0:r.paymentInstruments)&&(null==r?void 0:r.paymentInstruments[0]),[p,g]=(0,n.useState)(!0),{mutateAsync:E}=(0,T.useShopperBasketsMutation)("addPaymentInstrumentToBasket"),{mutateAsync:b}=(0,T.useShopperBasketsMutation)("updateBillingAddressForBasket"),{mutateAsync:h}=(0,T.useShopperBasketsMutation)("removePaymentInstrumentFromBasket"),x=(0,w.useToast)(),{step:C,STEPS:k,goToStep:D,goToNextStep:K}=(0,f.useCheckout)(),B=(0,I.cI)({mode:"onChange",shouldUnregister:!1,defaultValues:oe({},s)}),N=(0,ae.usePromoCode)(),{removePromoCode:L}=N,z=(0,_.Z)(N,le),V=(0,I.cI)(),$=function(){var e=(0,a.Z)((function*(e){const[t,a]=e.expiry.split("/"),n={paymentMethodId:"CREDIT_CARD",paymentCard:{holder:e.holder,maskedNumber:(0,j.getMaskCreditCardNumber)(e.number),cardType:(0,j.getPaymentInstrumentCardType)(e.cardType),expirationMonth:parseInt(t),expirationYear:parseInt(`20${a}`)}};return E({parameters:{basketId:null==r?void 0:r.basketId},body:n})}));return function(t){return e.apply(this,arguments)}}(),q=function(){var e=(0,a.Z)((function*(){if(!(yield B.trigger()))return;const e=p?i:B.getValues(),{addressId:t,creationDate:a,lastModified:n,preferred:l}=e,c=(0,_.Z)(e,ce);return b({body:c,parameters:{basketId:r.basketId,shipmentId:"me"}})}));return function(){return e.apply(this,arguments)}}(),R=function(){var e=(0,a.Z)((function*(){try{yield h({parameters:{basketId:r.basketId,paymentInstrumentId:m.paymentInstrumentId}})}catch(e){x({title:t(ne.API_ERROR_MESSAGE),status:"error"})}}));return function(){return e.apply(this,arguments)}}(),W=V.handleSubmit(function(){var e=(0,a.Z)((function*(e){m||(yield $(e)),yield q(),K()}));return function(t){return e.apply(this,arguments)}}());return n.createElement(A.ToggleCard,{id:"step-3",title:t({defaultMessage:[{type:0,value:"Payment"}],id:"checkout_payment.title.payment"}),editing:C===k.PAYMENT,isLoading:V.formState.isSubmitting||B.formState.isSubmitting,disabled:null==m,onEdit:()=>D(k.PAYMENT)},n.createElement(A.ToggleCardEdit,null,n.createElement(d.xu,{mt:-2,mb:4},n.createElement(ae.PromoCode,(0,v.Z)({},z,{itemProps:{border:"none"}}))),n.createElement(u.K,{spacing:6},null!=m&&m.paymentCard?n.createElement(u.K,{spacing:3},n.createElement(M.X,{as:"h3",fontSize:"md"},n.createElement(c.Z,{defaultMessage:[{type:0,value:"Credit Card"}],id:"checkout_payment.heading.credit_card"})),n.createElement(u.K,{direction:"row",spacing:4},n.createElement(ie,{payment:m}),n.createElement(y.z,{variant:"link",size:"sm",colorScheme:"red",onClick:R},n.createElement(c.Z,{defaultMessage:[{type:0,value:"Remove"}],id:"checkout_payment.action.remove"})))):n.createElement(ee,{form:V,onSubmit:$}),n.createElement(O.i,{borderColor:"gray.100"}),n.createElement(u.K,{spacing:2},n.createElement(M.X,{as:"h3",fontSize:"md"},n.createElement(c.Z,{defaultMessage:[{type:0,value:"Billing Address"}],id:"checkout_payment.heading.billing_address"})),n.createElement(P.X,{name:"billingSameAsShipping",isChecked:p,onChange:e=>g(e.target.checked)},n.createElement(S.x,{fontSize:"sm",color:"gray.700"},n.createElement(c.Z,{defaultMessage:[{type:0,value:"Same as shipping address"}],id:"checkout_payment.label.same_as_shipping"}))),p&&i&&n.createElement(d.xu,{pl:7},n.createElement(re.default,{address:i}))),!p&&n.createElement(te.default,{form:B,selectedAddress:s,hideSubmitButton:!0}),n.createElement(d.xu,{pt:3},n.createElement(o.W,{variant:"form"},n.createElement(y.z,{w:"full",onClick:W},n.createElement(c.Z,{defaultMessage:[{type:0,value:"Review Order"}],id:"checkout_payment.button.review_order"})))))),n.createElement(A.ToggleCardSummary,null,n.createElement(u.K,{spacing:6},m&&n.createElement(u.K,{spacing:3},n.createElement(M.X,{as:"h3",fontSize:"md"},n.createElement(c.Z,{defaultMessage:[{type:0,value:"Credit Card"}],id:"checkout_payment.heading.credit_card"})),n.createElement(ie,{payment:m})),n.createElement(O.i,{borderColor:"gray.100"}),s&&n.createElement(u.K,{spacing:2},n.createElement(M.X,{as:"h3",fontSize:"md"},n.createElement(c.Z,{defaultMessage:[{type:0,value:"Billing Address"}],id:"checkout_payment.heading.billing_address"})),n.createElement(re.default,{address:s})))))};var ue=r(93619),me=r(63536),pe=r(526);const ye=()=>n.createElement(d.xu,{background:"gray.50",flex:"1"},n.createElement(o.W,{"data-testid":"sf-checkout-skeleton",maxWidth:"container.xl",py:{base:7,lg:16},px:{base:0,lg:4}},n.createElement(i.r,{templateColumns:{base:"1fr",lg:"66% 1fr"},gap:{base:10,lg:20}},n.createElement(s.P,null,n.createElement(u.K,{spacing:4},n.createElement(pe.O,{height:"78px"}),n.createElement(pe.O,{height:"78px"}),n.createElement(pe.O,{height:"78px"}),n.createElement(pe.O,{height:"78px"}))),n.createElement(s.P,{py:6,px:[4,4,0]},n.createElement(u.K,{spacing:5},n.createElement(pe.O,{height:"30px",width:"50%"}),n.createElement(u.K,{spacing:5},n.createElement(pe.O,{height:"30px",width:"65%"}),n.createElement(u.K,{w:"full",py:4,borderY:"1px",borderColor:"gray.200"},n.createElement(pe.O,{height:6}),n.createElement(pe.O,{height:6}),n.createElement(pe.O,{height:6})),n.createElement(pe.O,{height:6}))))))),ge=()=>{const{formatMessage:e}=(0,l.Z)(),t=(0,g.default)(),{usid:r}=(0,T.useUsid)(),{step:v}=(0,f.useCheckout)(),[_,x]=(0,n.useState)(),{data:C}=(0,Z.useCurrentBasket)(),[k,M]=(0,n.useState)(!1),{mutateAsync:O}=(0,T.useShopperOrdersMutation)("createOrder");(0,n.useEffect)((()=>{(_||4===v)&&window.scrollTo({top:0})}),[_,v]);const P=function(){var n=(0,a.Z)((function*(){M(!0);try{const e=yield O({headers:{_sfdc_customer_id:r},body:{basketId:C.basketId}});t(`/checkout/confirmation/${e.orderNo}`)}catch(t){const r=e({id:"checkout.message.generic_error",defaultMessage:[{type:0,value:"An unexpected error occurred during checkout."}]});x(r)}finally{M(!1)}}));return function(){return n.apply(this,arguments)}}();return n.createElement(d.xu,{background:"gray.50",flex:"1"},n.createElement(o.W,{"data-testid":"sf-checkout-container",maxWidth:"container.xl",py:{base:7,lg:16},px:{base:0,lg:8}},n.createElement(i.r,{templateColumns:{base:"1fr",lg:"66% 1fr"},gap:{base:10,xl:20}},n.createElement(s.P,null,n.createElement(u.K,{spacing:4},_&&n.createElement(m.b,{status:"error",variant:"left-accent"},n.createElement(p.z,null),_),n.createElement(E.default,null),n.createElement(b.default,null),n.createElement(h.default,null),n.createElement(se,null),4===v&&n.createElement(d.xu,{pt:3,display:{base:"none",lg:"block"}},n.createElement(o.W,{variant:"form"},n.createElement(y.z,{w:"full",onClick:P,isLoading:k,"data-testid":"sf-checkout-place-order-btn"},n.createElement(c.Z,{defaultMessage:[{type:0,value:"Place Order"}],id:"checkout.button.place_order"})))))),n.createElement(s.P,{py:6,px:[4,4,4,0]},n.createElement(ue.default,{basket:C,showTaxEstimationForm:!1,showCartItems:!0}),4===v&&n.createElement(d.xu,{display:{base:"none",lg:"block"},pt:2},n.createElement(y.z,{w:"full",onClick:P,isLoading:k},n.createElement(c.Z,{defaultMessage:[{type:0,value:"Place Order"}],id:"checkout.button.place_order"})))))),4===v&&n.createElement(d.xu,{display:{lg:"none"},position:"sticky",bottom:"0",px:4,pt:6,pb:11,background:"white",borderTop:"1px solid",borderColor:"gray.100"},n.createElement(o.W,{variant:"form"},n.createElement(y.z,{w:"full",onClick:P,isLoading:k},n.createElement(c.Z,{defaultMessage:[{type:0,value:"Place Order"}],id:"checkout.button.place_order"})))))},fe=()=>{const{data:e}=(0,me.useCurrentCustomer)(),{data:t}=(0,Z.useCurrentBasket)();return e&&e.customerId&&t&&t.basketId?n.createElement(f.CheckoutProvider,null,n.createElement(ge,null)):n.createElement(ye,null)}}}]);
//# sourceMappingURL=pages-checkout.js.map